{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)de3d1630-806b-472e-a210-c197363116ad","ParentGuid":"(Guid)00000000-0000-0000-0000-000000000000","Name":"(string)FB_ZebraPrinter","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)829a18f2-c514-4f6e-9634-1df173429203","@Value":{"@Type":"829a18f2","@Value":{"ParentObjects":{"@Type":"fa2ee218:IDictionary","@Value":[{"@Key":"(Guid)21af5390-2942-461a-bf89-951aaf6999f1","@Value":"(Guid)1c28a211-3067-4c0b-9a07-254125110570"}]}}}}]},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","829a18f2":"{829a18f2-c514-4f6e-9634-1df173429203}","fa2ee218":"{fa2ee218-a39b-4b6d-b249-49dbddbd168a}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)//    Function Block: FB_ZebraPrinter\n//    Description: This program manages the aspects of a (Zebra) printer\n//    Created by: Ben Hess\n//    Created Date: April 2nd, 2018\nSUPER^();\n\n_hasLabel := dataReadyInput OR simulateIO OR dryCycleEnable;\n\nendOfPrintONS(CLK := endOfPrintInput);\n//Report as ready if mode is auto and we're not faulted\n_ready := NOT (state = eZebraPrinterStates.Fault);\n\nprinterRibbonMovingTimer1(PT := printerRibbonMovingSettleTime);\nprinterRibbonMovingTimer2(PT := printerRibbonMovingSettleTime);\n\nprinterRibbonMovingTimer1(PT := T#1H);\nprinterRibbonMovingTimer2(PT := T#1H);\n\n\nprintHeadDebounce(PT:= printHeadDebounceSetting, Q=> printHeadDebounced);\nraisePrintHeadDelay();\n\nwaitingForPrinter := state = eZebraPrinterStates.WaitingForData;\n// printHeadLowerFaultTimer(IN := lowerPrintHeadOutput AND NOT printHeadDownInput);\n// printHeadRaiseFaultTimer(IN := NOT lowerPrintHeadOutput AND printHeadDownInput);\n// \n// IF printHeadLowerFaultTimer.Q AND THIS^.OptionActive THEN\n// \tprintHeadFailToLower.Trigger();\n// END_IF\n// \n// IF printHeadRaiseFaultTimer.Q AND THIS^.OptionActive THEN\n// \tprintHeadFailToRaise.Trigger();\n// END_IF\n\nIF NOT serviceRequiredInput AND eStopOK AND THIS^.OptionActive THEN\n\tserviceRequired.Trigger();\nEND_IF\n\nresetONS(CLK := _reset);\nIF enableONS.Q OR resetONS.Q THEN\n    state := eZebraPrinterStates.Idle;\n\t_reset := FALSE;\n\t_beginPrinting := FALSE;\n\t_stopPrinting := FALSE;\n\tprintHeadDebounced := FALSE;\n\tribbonUnwindRunOutput := FALSE;\n\tlowerPrintHeadOutput := FALSE;\n\tprinterRibbonMovingTimer1.IN := FALSE;\n\tprinterRibbonMovingTimer2.IN := FALSE;\nEND_IF\n\nIF NOT THIS^.OptionEnabled THEN\n    state := eZebraPrinterStates.Fault;\n\tribbonUnwindRunOutput := FALSE;\n\tlowerPrintHeadOutput := FALSE;\nEND_IF\n\n//State machine for the printer\nCASE state OF\n    eZebraPrinterStates.Idle :                            \n\t\t// Go to waiting for data if printer is ready\n        ribbonUnwindRunOutput := FALSE;\n\t\tstartPrintOutput := FALSE;\n\t\tprintHeadDebounce.IN := FALSE;\n\t\tprintHeadDebounced := FALSE;\n\t\traisePrintHeadDelay.IN := FALSE;\n\t\tprinterRibbonMovingTimer1.IN := FALSE;\n\t\tprinterRibbonMovingTimer2.IN := FALSE;\n\t\t_printing := FALSE;\n\t\t_stopPrinting := FALSE;\n\t\tIF _beginPrinting AND THIS^.OptionEnabled THEN\n\t\t\t_printDone := FALSE;\n\t\t\tIF NOT dataReadyInput THEN\n\t\t\t\tstate := eZebraPrinterStates.WaitingForData;\n\t\t\tELSE\n\t\t\t\tstate := eZebraPrinterStates.DataReady;\n\t\t\tEND_IF\n\t\tEND_IF\n\t\t\n        IF serviceRaisePrintHead THEN\n\t\t\tlowerPrintHeadOutput := FALSE;\n\t\tELSIF serviceLowerPrintHead THEN\n\t\t\tlowerPrintHeadOutput := TRUE;\n\t\tEND_IF\n                                        \n    eZebraPrinterStates.WaitingForData:            \n\t\t// If printerDataReady drops out the label data was received\n        IF dataReadyInput OR dryCycleEnable THEN\n            state := eZebraPrinterStates.DataReady;    \n        END_IF\n\t\tIF cancelPrint THEN\n\t\t\tstate := eZebraPrinterStates.Idle;  \n\t\tEND_IF\n                                                \n    eZebraPrinterStates.DataReady:                        \n\t\t// Wait for command to begin printing\n         IF (NOT dataReadyInput AND NOT dryCycleEnable) OR cancelPrint THEN\n\t\t\tstate := eZebraPrinterStates.Idle;\n\t\tEND_IF\n\t\tIF _beginPrinting THEN\n\t\t\t _printing := TRUE;\n             _beginPrinting := FALSE;\n\t\t\t printHeadDebounce.IN := TRUE;\n             lowerPrintHeadOutput :=  NOT dryCycleEnable;\n             ribbonUnwindRunOutput := NOT dryCycleEnable;\n\t\t\t state := eZebraPrinterStates.BeginPrintCycle;\n         END_IF                                    \n            \n    eZebraPrinterStates.BeginPrintCycle:           \n\t\t// Start printing\n        IF printHeadDebounced THEN\n            startPrintOutput := NOT dryCycleEnable;\n            state := eZebraPrinterStates.Printing;\n            printHeadDebounce.IN := FALSE;\n        END_IF                                                    \n                                                              \n    eZebraPrinterStates.Printing:                        \n\t\t// While printing, wait for End of Print signal\t\n\t\tprinterRibbonMovingTimer1.IN := ribbonEncoderPulseInput;\n\t\tprinterRibbonMovingTimer2.IN := NOT ribbonEncoderPulseInput;\n        IF endOfPrintONS.Q OR printerRibbonMovingTimer1.Q OR printerRibbonMovingTimer2.Q OR dryCycleEnable OR _stopPrinting THEN\n            startPrintOutput := FALSE;\n\t\t\t_stopPrinting := FALSE;\n\t\t\tribbonUnwindRunOutput := FALSE;\n\t\t\tIF printerRibbonMovingTimer1.Q OR printerRibbonMovingTimer2.Q THEN\n\t\t\t\tribbonFault.Trigger();\n\t\t\tEND_IF\n\t\t\tprinterRibbonMovingTimer1.IN := FALSE;\n\t\t\tprinterRibbonMovingTimer2.IN := FALSE;\n\t\t\traisePrintHeadDelay.IN := TRUE;\n            state := eZebraPrinterStates.DonePrinting;    \n        END_IF\n                                        \n    eZebraPrinterStates.DonePrinting:              \n\t\t// Done printing, feed a little more through\n\t\tIF raisePrintHeadDelay.Q THEN\n\t\t\traisePrintHeadDelay.IN := FALSE;\n\t\t\tlowerPrintHeadOutput := FALSE;\n\t\t\t_printing := FALSE;\n\t\t\t_printDone := TRUE;\n\t\t\tstate := eZebraPrinterStates.Idle;\n\t\tEND_IF                       \n                                        \n    eZebraPrinterStates.Fault:              \t\t\n\t\t// Clear status on fault\n\t\t_printing := FALSE;\n\t\t\t\t\t\t\t\t\t\t\t\t\t          \n                                        \nEND_CASE","LineInfoPersistence":"(string)de3d1630-806b-472e-a210-c197363116ad_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)FUNCTION_BLOCK FB_ZebraPrinter EXTENDS FB_BasicPrinter\nVAR_INPUT\n\tprintHeadDebounceSetting : TIME := T#20MS;\n\tprintHeadDownInput : BOOL;\n\tdataReadyInput : BOOL;\n\tserviceRequiredInput : BOOL;\n\teStopOK : BOOL;\n\tribbonLowInput : BOOL;\n\tendOfPrintInput : BOOL;\n\tribbonEncoderPulseInput : BOOL;\n\tserviceRaisePrintHead : BOOL;\n\tserviceLowerPrintHead : BOOL;\n\tcancelPrint : BOOL;\n\tdryCycleEnable : BOOL;\nEND_VAR\nVAR_OUTPUT\n\tserviceRequired : FB_Fault(name := Standard.CONCAT(_prefix,'Service Required'));\n\tribbonFault : FB_Fault(name := 'Printer Ribbon Fault');\n\tprintHeadFailToLower : FB_Fault(name := 'Printhead Failed to Lower');\n\tprintHeadFailToRaise : FB_Fault(name := 'Printhead Failed to Raise');\n\tprintHeadDebounced : BOOL;\n\tstartPrintOutput : BOOL;\n\tribbonUnwindRunOutput : BOOL;\n\tlowerPrintHeadOutput : BOOL;\n\twaitingForPrinter : BOOL;\nEND_VAR\nVAR\n\tprintHeadDebounce : TON;\n\tprintHeadLowerFaultTimer : Standard.TON := (PT := T#1S);\n\tprintHeadRaiseFaultTimer : Standard.TON := (PT := T#1S);\n\traisePrintHeadDelay  : Standard.TON := (PT := T#75MS);\n\tendOfPrintONS : Standard.F_TRIG();\n\tprinterRibbonMovingTimer1 : Standard.TON;\n\tprinterRibbonMovingTimer2 : Standard.TON;\n\tprinterRibbonMovingSettleTime : TIME := T#1h;//T#450MS;\nEND_VAR\n","LineInfoPersistence":"(string)de3d1630-806b-472e-a210-c197363116ad_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)271","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}