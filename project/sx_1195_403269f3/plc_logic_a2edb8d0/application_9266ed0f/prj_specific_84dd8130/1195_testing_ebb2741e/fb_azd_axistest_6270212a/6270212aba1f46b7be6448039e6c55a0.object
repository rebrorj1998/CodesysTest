{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)6270212a-ba1f-46b7-be64-48039e6c55a0","ParentGuid":"(Guid)9266ed0f-7f1e-4370-8ffa-55b419b1a46d","Name":"(string)FB_AZD_AxisTest","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)829a18f2-c514-4f6e-9634-1df173429203","@Value":{"@Type":"829a18f2","@Value":{"ParentObjects":{"@Type":"fa2ee218:IDictionary","@Value":[{"@Key":"(Guid)d9b2b2cc-ea99-4c3b-aa42-1e5c49e65b84","@Value":"(Guid)ebb2741e-3cd4-479c-a40d-a240dbdfdd95"}]}}}}]},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","829a18f2":"{829a18f2-c514-4f6e-9634-1df173429203}","fa2ee218":"{fa2ee218-a39b-4b6d-b249-49dbddbd168a}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)_jawClampTest(\n\txExecute:= , \n\txDone=> , \n\txBusy=> , \n\txError=> , \n\tdriveAlarm:= NOT iPbarClampMotorAlarm, \n\tclampMotionInSeconds:= HMIData.jawClampTime, \n\treverseMotionInSeconds:= HMIData.jawClampReverseTime, \n\tintervalInSeconds:= HMIData.jawClampInterval, \n\toStartMotor=> oPbarClampMotorStart, \n\toForwardMotor=> oPbarClampMotorReverse, \n\tcycleTestActive=> HMIData.jawClampCycleTestActive,\n\tjawClampCycleTestCounter := jawClampCount\n);\n_axis1(\n\taxisData := AxisData.jaw,\n\tcommStatus := TRUE,\n\tiActualPosition := iFrontJawAxisPositionActualValue,\n\tiActualVelocity := iFrontJawAxisVelocityActualValue,\n\tiErrorCode := iFrontJawAxisErrorcode,\n\tiModeOfOperation := iFrontJawAxisModesOfOperationDisplay,\n\tiStatusword := iFrontJawAxisStatusword,\n\toControlword => oFrontJawAxisControlword,\n\toModeOfOperation => oFrontJawAxisModesOfOperation,\n\toTargetPosition => oFrontJawAxisTargetPosition,\n\toProfileAcceleration => oFrontJawAxisProfileAcceleration,\n\toProfileDeceleration => oFrontJawAxisProfileDeceleration,\n\toProfileVelocity => oFrontJawAxisProfileVelocity,\n\toProfilePushCurrent => oFrontJawAxisPushCurrent,\n\toProfileOperationalCurrent => oFrontJawAxisBaseCurrent,\n\tdefaultCurrent := 100.0\n);\n\n_axis2(\n\taxisData := AxisData.FilmFeed,\n\tcommStatus := TRUE,\n\tiActualPosition := iFilmFeedAxisPositionActualValue,\n\tiActualVelocity := iFilmFeedAxisVelocityActualValue,\n\tiErrorCode := iFilmFeedAxisErrorcode,\n\tiModeOfOperation := iFilmFeedAxisModesOfOperationDisplay,\n\tiStatusword := iFilmFeedAxisStatusword,\n\toControlword => oFilmFeedAxisControlword,\n\toModeOfOperation => oFilmFeedAxisModesOfOperation,\n\toTargetPosition => oFilmFeedAxisTargetPosition,\n\toProfileAcceleration => oFilmFeedAxisProfileAcceleration,\n\toProfileDeceleration => oFilmFeedAxisProfileDeceleration,\n\toProfileVelocity => oFilmFeedAxisProfileVelocity,\n\toProfilePushCurrent => oFilmFeedAxisPushCurrent,\n\toProfileOperationalCurrent => oFilmFeedAxisBaseCurrent,\n\tdefaultCurrent := 100.0\n);\n\njawMotionDriveErrorString := TO_STRING(_axis1.alarmCode);\njawActualPosition := _axis1.actualPositonInInches;\njawMotionError := _axis1._statusword.fault;\n\nfilmMotionDriveErrorString := TO_STRING(_axis2.alarmCode);\nfilmActualPosition := _axis2.actualPositonInInches;\nfilmMotionError := _axis2._statusword.fault;\n\nclampError := NOT iPbarClampMotorAlarm;\ntestActive := _activeKeepJawCycling;\n//\n_PBPowerUP(\n\tenable := F_EtherCatSlaveCommsRunning(state := AZD4A_KED.wState) AND _enableJaw, \n\taxis := _axis1\n);\n\n_filmFeedPowerUp(\n\tenable := F_EtherCatSlaveCommsRunning(state := AZD4A_KED.wState) AND _enableFilmFeed, \n\taxis := _axis2\n);\n\n_axis1Reset(axis := _axis1);\n_axis1ABS_in(axis := _axis1);\n_axis1ABS_out(axis := _axis1);\n_axis1ABSPush(axis := _axis1);\n_axis1ABSPushZero(axis := _axis1);\n_axis1Home(axis := _axis1);\n_axis1Halt(axis := _axis1);\n\n_axis2Reset(axis := _axis2);\n_axis2ABS(axis := _axis2);\n\n_axis1ABS_in.acceleration := moveInProfile.acceleration;\n_axis1ABS_in.deceleration := moveInProfile.deceleration;\n_axis1ABS_in.velocity := moveInProfile.velocity;\n_axis1ABS_in.position := moveInProfile.position;\n_axis1ABS_in.currentLimit := moveInProfile.current;\n//_axis1ABS.execute := _axis1ABSExecute;\n\n_axis1ABSPush.acceleration := pushProfile.acceleration;\n_axis1ABSPush.deceleration := pushProfile.deceleration;\n_axis1ABSPush.velocity := pushProfile.velocity;\n_axis1ABSPush.position := pushProfile.position;\n_axis1ABSPush.currentLimit := pushProfile.current;\n\n_axis1ABSPushZero.acceleration := moveInProfile.acceleration;\n_axis1ABSPushZero.deceleration := moveInProfile.deceleration;\n_axis1ABSPushZero.velocity := 0.7;\n_axis1ABSPushZero.position := moveInProfile.position;\n_axis1ABSPushZero.currentLimit := 25;\n\n_axis1ABS_out.acceleration := moveOutProfile.acceleration;\n_axis1ABS_out.deceleration := moveOutProfile.deceleration;\n_axis1ABS_out.velocity := moveOutProfile.velocity;\n_axis1ABS_out.position := moveOutProfile.position;\n_axis1ABS_out.currentLimit := moveOutProfile.current;\n\n_axis2ABS.acceleration := _activeFilmMotionProfile.acceleration;\n_axis2ABS.deceleration := _activeFilmMotionProfile.deceleration;\n_axis2ABS.velocity := _activeFilmMotionProfile.velocity;\n_axis2ABS.position := _activeFilmMotionProfile.position;\n_axis2ABS.currentLimit := _activeFilmMotionProfile.current;\n//_axis1ABSPush.execute := ;\n\n_closeHoldTimer(IN := (_jawState = 24) AND NOT enableClamping);\n_openHoldTimer(IN := _jawState = 11 AND _axis1ABS_out.Done);\n_pushWaitTimer(IN := _jawState = 21 AND _axis1ABS_in.Done);\n_haltWaitTimer(IN := _jawState = 25 AND _enableHalt);\n_haltClearTimer(IN := _jawState = 26 AND _enableHalt);\nIF stopTesting THEN\n\t_jawState := 0;\n\t_filmFeedState := 0;\n\t_activeKeepJawCycling := FALSE;\n\t_activeKeepFilmCycling := FALSE;\nEND_IF\n\nIF enableClamping AND _jawState = 21 AND _axis1.actualPositonInInches < 5.5 AND NOT clampONS THEN\n\t_jawClampTest.Start();\n\tclampONS := TRUE;\nEND_IF\n\nCASE _jawState OF\n\t0: // Idle\n\t\t_axis1ABSPush.execute := FALSE;\n\t\t_axis1ABS_in.execute := FALSE;\n\t\t_axis1ABS_out.execute := FALSE;\n\t\tIF (startTesting AND enableJawMotion) OR _activeKeepJawCycling THEN\n\t\t\t_jawState := 10;\n\t\t\t_activeKeepJawCycling := TRUE;\n\t\tELSIF (startTesting AND (enableClamping AND NOT enableJawMotion)) THEN\n\t\t\t_jawState := 30;\n\t\tEND_IF\n\t\t\n\t10: // Open Up\n\t\t_activeJawMotionProfile := moveOutProfile;\n\t\t_axis1ABS_out.execute := TRUE;\n\t\t_jawState := 11;\n\t\n\t11: // Wait for open\n\t\t\n\t\tIF _axis1ABS_out.Done AND _openHoldTimer.Q THEN\n\t\t\t_axis1ABS_out.execute := FALSE; \n\t\t\t_jawState := 20;\n\t\tEND_IF\n\t\t\n\t20: // Close to 0\n\n \t\t_activeJawMotionProfile := moveInProfile;\n\t\t_axis1ABS_in.execute := TRUE;\n\t\t_jawState := 21;\n\t\t\n\t21: // Wait for close\n\t\t\n\t\tIF _axis1ABS_in.Done THEN\n\t\t\t//_axis1ABS.execute := FALSE;\n\t\t\t_axis1ABS_in.execute := FALSE;\n\t\t\t//IF enableClamping AND NOT clampONS THEN\n\t\t\t//\t_jawClampTest.Start();\n\t\t\t//\tclampONS := TRUE;\n\t\t\t//END_IF\n\t\t\tIF _enablePush AND _pushWaitTimer.Q THEN\n\t\t\t\t_jawState := 22;\n\t\t\t\tclampONS := FALSE;\n\t\t\tELSIF NOT _enablePush THEN\n\t\t\t\t_jawState := 24;\n\t\t\tEND_IF\n\t\t\t\n\t\t\t\n\t\tEND_IF\n\t\t\n\t22: // Push in\n\t\t_activeJawMotionProfile := pushProfile;\n\t\t_axis1ABSPush.execute := TRUE;\n\t\t_jawState := 23;\n\t\t//Hold\n\t\t\n\t\t\n\t23: //Wait for pushed in\n\t\t\n\t\t\n\t\tIF _axis1ABSPush.Done  THEN\n\t\t\t_axis1ABSPush.execute := FALSE;\n\t\t\t_jawState := 24;\n\t\tEND_IF\n\t\t\t\t\n\t24: // hold\n\t\t//IF _jawClampTest.Done OR _closeHoldTimer.Q THEN\n\t\tIF _jawClampTest.Done OR _closeHoldTimer.Q THEN\n\t\t\t_haltWaitTimer.IN := FALSE;\n\t\t\tjawMotionCount := jawMotionCount + 1;\n\t\t\tIF enableClamping THEN\n\t\t\t\tjawClampCount := jawClampCount + 1;\n\t\t\tEND_IF\n\t\t\t\n\t\t\tIF _enableHalt THEN\n\t\t\t\t_axis1ABSPushZero.execute := TRUE;\n\t\t\t\t//_axis1Halt.execute := TRUE;\n\t\t\t\t//_axis1.halt := TRUE;\t\t\t\t\n\t\t\t\t_jawState := 25;\n\t\t\tELSE\n\t\t\t\t_jawState := 0;\n\t\t\tEND_IF\t\t\n\t\tEND_IF\n\t\n\t25: //wait for halt delay\n\t\t//_axis1Halt.execute := FALSE;\n\t\tIF _enableHalt AND _haltWaitTimer.Q AND _axis1ABSPushZero.Done THEN\n\t\t\t_axis1ABSPushZero.execute := FALSE;\n\t\t\t//_axis1.halt := FALSE;\t\n\t\t\t_jawState := 26;\n\t\tEND_IF \t\n\t\t\n\t26: // Wait to move until halt is off for a bit\n\t\tIF _haltClearTimer.Q THEN\n\t\t\t_jawState := 0;\n\t\tEND_IF\n\t\t\n\t30: // Clamp Cycle Only\n\t\t_jawClampTest.Start();\n\t\t_jawState := 31;\n\t\n\t31: // \n\t\tIF _jawClampTest.Done THEN\n\t\t\t_jawState := 0;\n\t\t\tjawClampCount := jawClampCount + 1;\n\t\tEND_IF\n\t\t\n\t\t\nEND_CASE\n\n\n// Film Feed state machine\nCASE _filmFeedState OF\n\t0: // Idle\n\t\t_axis2ABS.execute := FALSE;\n\t\tIF (startTesting AND enableFilmFeedMotion) OR _activeKeepFilmCycling THEN\n\t\t\t_filmFeedState := 10;\n\t\t\t_activeKeepFilmCycling := TRUE;\n\t\tEND_IF\n\t\t\n\t10: // Back Up\n\t\t_activeFilmMotionProfile := reverseBagFeedProfile;\n\t\t_axis2ABS.execute := TRUE;\n\t\t_filmFeedState := 11;\n\t\t\n\t11: // Wait for reverse\n\t\tIF _axis2ABS.Done THEN\n\t\t\t_axis2ABS.execute := FALSE; \n\t\t\t_filmFeedState := 20;\n\t\tEND_IF\n\t\t\n\t20: // Feed forward\n\t\t_activeFilmMotionProfile := forwardBagFeedProfile;\n\t\t_axis2ABS.execute := TRUE;\n\t\t_filmFeedState := 21;\n\t\t\n\t21: // Wait for reverse\n\t\tIF _axis2ABS.Done THEN\n\t\t\t_axis2ABS.execute := FALSE; \n\t\t\tfilmFeedMotionCount := filmFeedMotionCount + 1;\n\t\t\t_filmFeedState := 0;\n\t\tEND_IF\n\t\t\nEND_CASE\n\n\n\n// Reset everything\n\n_resetONS(CLK := HMIData.jawResetDrives);\n_resettingTimer(IN := _resetState = 10);\nCASE _resetState OF\n\t0: // Clear Flags\n\t\tIF _resetONS.OSR THEN\n\t\t\t//_reset := FALSE;\n\t\t\t_axis1ABSPush.execute := FALSE;\n\t\t\t_axis1ABS_in.execute := FALSE;\n\t\t\t_axis1ABS_out.execute := FALSE;\n\t\t\t_axis1ABSPushZero.execute := FALSE;\n\t\t\t_axis1Reset.execute := FALSE;\n\t\t\t_axis2ABS.execute := FALSE;\n\t\t\t_axis2Reset.execute := FALSE;\n\t\t\t_enableJaw := FALSE;\n\t\t\t_enableFilmFeed := FALSE;\n\t\t\t_activeKeepJawCycling := FALSE;\n\t\t\t_activeKeepFilmCycling := FALSE;\n\t\t\t_resetState := 10;\n\t\tEND_IF\n\t\t\n\t10: // reset axis'\n\t\t_jawState := 0;\n\t\t_axis1Reset.execute := TRUE;\n\t\t_axis2Reset.execute := TRUE;\n\t\tIF _resettingTimer.Q THEN\n\t\t\t_axis1Reset.execute := FALSE;\n\t\t\t_axis2Reset.execute := FALSE;\n\t\t\t_enableJaw := TRUE;\n\t\t\t_enableFilmFeed := TRUE;\n\t\t\t_resetState := 11;\n\t\tEND_IF\n\t\t\n\t11: // wait for power up\n\t\tIF _axis1.operational AND _axis2.operational THEN\n\t\t\t_resetState := 20;\n\t\tEND_IF\n\t\t\n\t20: // Move the jaw out\n\t\t_activeJawMotionProfile := moveOutProfile;\n\t\t_axis1ABS_out.execute := TRUE;\n\t\t_resetState := 21;\n\t\t\n\t21:\n\t\tIF _axis1ABS_out.Done THEN\n\t\t\t_axis1ABS_out.execute := FALSE;\n\t\t\t_resetState := 0;\n\t\tEND_IF\nEND_CASE\n\n","LineInfoPersistence":"(string)6270212a-ba1f-46b7-be64-48039e6c55a0_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)FUNCTION_BLOCK FB_AZD_AxisTest\nVAR_INPUT\n\tenableClamping : BOOL;\n\tenableJawMotion : BOOL;\n\tenableFilmFeedMotion : BOOL;\n\tstartTesting : BOOL;\n\tstopTesting : BOOL;\n\tmoveInProfile : sctMotionProfile;\n\tmoveOutProfile: sctMotionProfile;\n\tpushProfile : sctMotionProfile;\n\treverseBagFeedProfile : sctMotionProfile;\n\tforwardBagFeedProfile : sctMotionProfile;\nEND_VAR\n\nVAR_OUTPUT\n\tclampError : BOOL;\n\tjawMotionError : BOOL;\n\tjawMotionDriveErrorString : STRING;\n\tjawActualPosition : REAL;\n\tfilmMotionError : BOOL;\n\tfilmMotionDriveErrorString : STRING;\n\tfilmActualPosition : REAL;\n\ttestActive : BOOL;\nEND_VAR\nVAR\n\t_jogForward : BOOL;\n\t_jogReverse : BOOL;\n\t_axis1 : FB_AZDKAxis;\n\t_axis2 : FB_AZDKAxis;\n\t_enableJaw : BOOL;\n\t_PBPowerUP : MC_Power;\n\t_filmFeedPowerUp : MC_Power;\n\t_axis1ABS_in : MC_MoveAbsolute;\n\t_axis1ABS_out : MC_MoveAbsolute;\n\t_axis1ABSPush : MC_MoveAbsolutePush;\n\t_axis1ABSPushZero : MC_MoveAbsolutePush;\n\t_axis1Reset : MC_Reset;\n\t_axis1Home : MC_Home;\n\t_axis1Halt : MC_Halt;\n\t_axis2Reset : MC_Reset;\n\t_axis2ABS : MC_MoveAbsolute;\n\t_axis1ABSPos : REAL;\n\t_ethercatState : WORD;\n\t_testReset : BOOL;\n\t_reset : BOOL;\n\t_jawState : INT;\n\t_activeKeepJawCycling : BOOL;\n\t_activeKeepFilmCycling : BOOL;\n\t_closedPosition : REAL;\n\t_clampedPosition : REAL := -1;\n\t_openPosition : REAL := 5.5;\n\t_closeHoldTimer : Standard.TON := (PT := T#0S);\n\t_openHoldTimer : Standard.TON := (PT := T#100MS);\n\t_pushWaitTimer : TON := (PT := T#0MS);\n\t_haltWaitTimer : TON := (PT := T#50MS);\n\t_haltClearTimer : TON := (PT := T#500ms);\n\t_resetState : INT;\n\t_resettingTimer : Standard.TON := (PT := T#100MS);\n\t_jawClampTest : FB_JawClampTest();\n\t_home : BOOL;\n\t_enablePush : BOOL;\n\t_enableHalt : BOOL;\n\t_activeJawMotionProfile : sctMotionProfile;\n\t_activeFilmMotionProfile : sctMotionProfile;\n\t_enableFilmFeed : BOOL;\n\t_filmFeedState : INT;\n\t_resetONS : FB_ONS;\n\tclampONS : BOOL;\nEND_VAR\n\nVAR_IN_OUT\n\tjawMotionCount : DINT;\n\tjawClampCount : DINT;\n\tfilmFeedMotionCount : DINT;\nEND_VAR","LineInfoPersistence":"(string)6270212a-ba1f-46b7-be64-48039e6c55a0_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)4612","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}