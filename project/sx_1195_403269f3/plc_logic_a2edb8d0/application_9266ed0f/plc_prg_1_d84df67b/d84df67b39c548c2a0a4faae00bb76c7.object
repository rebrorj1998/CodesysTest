{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)d84df67b-39c5-48c2-a0a4-faae00bb76c7","ParentGuid":"(Guid)9266ed0f-7f1e-4370-8ffa-55b419b1a46d","Name":"(string)PLC_PRG_1","Properties":{"@Type":"2c41fa04:IDictionary","@Value":{}},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)//\tProgram: PLC_PRG\n//\tDescription: Base program for the 1195 SX. \n//\t\t\t\t \n//\tCreated by: Ben Hess\n//\tCreated Date: \n\nIO_Map();\n// Initialze global objects on first scan\nIF NOT firstScanDone THEN\n\tGlobalObjects.CollectionOfInitialzable.InitializeAll();\n\tGlobalObjects.CollectionOfLoggable.RegisterAll(internalLogger := GlobalData.SystemLog);\n\tGlobalObjects.CollectionOfFaults.FaultUpdateForHMI();\n\thIecTask := IecTaskGetCurrent(0);\n\tIecTaskDisableWatchdog(hIecTask); // Watchdog disabled\n\tfirstScanDone := TRUE;\nEND_IF\nIF firstAborted AND UN00_SXMachine.currentState = PACK_ML.State.Aborted THEN\n\tfirstAborted := FALSE;\nEND_IF\nIF flipFlop.Q THEN\n\tHMIData.counterChange := NOT HMIData.counterChange; \nEND_IF\nflipFlop(IN := not flipFlop.Q,PT := T#500MS);\n// Use fault collection for faultActive indication\nHMIData.faultActive := GlobalObjects.CollectionOfActiveFaults.faultActive;\n\n// Cycle start conditions\n// Auto mode dwell timer\nautoModeTimer(PT := TO_TIME(HMIData.autoModeDwell * 1000), IN := autoModeKeepCycling AND UN00_SXMachine.currentState = PACK_ML.State.Execute AND NOT HMIData.inCycle);\n// Start from Cycle Start input\ncycleStartDebounce(IN := iCycleStart);\ncycleStartONS(clk := cycleStartDebounce.Q);\ncycleStartONS.OSR;  //added to monitor wihle testing\n\n//Light Curtain Start\nlightCurtainStartClear := iLightCurtainStart;\nlightCurtainStartONS(CLK := iLightCurtainStart AND HMIData.lightCurtainInstalled);\n// Trigger a fault if the light curtain input is seen but there isn't a light curtain configured in \nIF iLightCurtainStart AND NOT HMIData.lightCurtainInstalled THEN\n\tlightCurtainPresent.Trigger();\nEND_IF\n//IF iLightCurtainStart THEN\n//\tHMIData.lightCurtainInstalled := TRUE;\n//END_IF\n\n// Batch Counter\nbatchCounter(CU := cycleComplete.OSR, RESET := (NOT HMIData.batchEnable) OR HMIData.resetBatchCounter, PV := TO_WORD(HMIData.batchSetting), Q => HMIData.batchCounterDone, CV => HMIData.batchCount);\nIF HMIData.resetBatchCounter THEN \n\tHMIData.resetBatchCounter := FALSE;\t\nEND_IF\n\n// Parts Counter\npartsCounter(CU := lightCurtainStartONS.OSR AND HMIData.lightCurtainInstalled AND HMIData.partsCounterEnable AND NOT HMIData.inCycle, \nRESET := (NOT (HMIData.lightCurtainInstalled OR HMIData.partsCounterEnable)) OR cycleComplete.OSR OR HMIData.ackAllFaults, \nPV := TO_WORD(HMIData.partsCounterSetting), \nQ => HMIData.partsCounterDone, \nCV => HMIData.partsCounterCount);\n\n\n// All start conditions\nIF (HMIData.initiateCycle \n\tOR cycleStartONS.OSR \n\tOR autoModeTimer.Q \n\tOR (lightCurtainStartONS.OSR AND NOT HMIData.partsCounterEnable) \n\tOR (partsCounter.Q AND HMIData.partsCounterEnable)) AND NOT HMIData.batchCounterDone \n\tTHEN\n\t\tIF UN00_SXMachine.currentState = PACK_ML.State.Execute AND NOT HMIData.inCycle THEN\n\t\t\tEM01_SXBaggerHead.StartCycle();\n\t\t\tIF HMIData.autoModeEnable THEN\n\t\t\t\tautoModeKeepCycling := TRUE;\n\t\t\tEND_IF\n\t\tEND_IF\n\tHMIData.initiateCycle := FALSE;\nEND_IF\n// Unlatch flag for auto mode when faulted or stopped\nIF UN00_SXMachine.currentState <> PACK_ML.State.Execute OR HMIData.ackAllFaults OR NOT HMIData.autoModeEnable THEN\n\tautoModeKeepCycling := FALSE;\nEND_IF\n\n// Only faults execute automatically to handle acking and clearing without being run in each FB that contains them\nIF firstScanDone THEN\n\tGlobalObjects.CollectionOfExecutable.ExecuteAll();\nEND_IF\n\n\n// Barcode Verifier manual trigger\nIF HMIData.barcodeVerifierTrigger THEN\n\tbaggerCM.barcodeVerifier.TriggerImmediate();\n\tHMIData.barcodeVerifierTrigger := FALSE;\nEND_IF\n\n// Printer sample label sending\nIF HMIData.sendSampleLabels AND NOT printerLabel.xExecute THEN\n\tprinterLabel.xExecute := TRUE;\n\tprinterLabel.sendSampleLabel := TRUE;\n\tprinterLabel.sendClearLabel := FALSE;\n\tHMIData.sendSampleLabels := FALSE;\nELSIF HMIData.clearAllLabels AND NOT printerLabel.xExecute THEN\n\tprinterLabel.xExecute := TRUE;\n\tprinterLabel.sendSampleLabel := FALSE;\n\tprinterLabel.sendClearLabel := TRUE;\n\tHMIData.clearAllLabels := FALSE;\nEND_IF\n\nIF printerLabel.xDone THEN\n\tprinterLabel.xExecute := FALSE;\nEND_IF\nprinterLabel();\n\n// Run collection of bagger control modules\nbaggerCM(inhibitMotion:= firstAborted);\ndischargeCM(loadPlateInterlocks:= loadPlateInterlocks);\n\n// Set bagger head control modules\nEM01_SXBaggerHead(\n\tbagOpenFingers:= baggerCM.BOF, \n\tsealFlatteners:= baggerCM.SealFlatteners, \n\tsealer:= baggerCM.sealWire, \n\tpressureBar:= baggerCM.dualMotorPassthrough, \n\tprinter:= baggerCM.labelPrinter, \n\tbagDelivery:= baggercm.bagDelivery, \n\tvacuumBagOpen:= baggerCM.VacuumCups, \n\tIBD:= baggerCM.IBD, \n\tloadPlate:= dischargeCM.loadPlate, \n\tbarcodeVerifier:= baggerCM.barcodeVerifier, \n\tbagOpenAssistEnabled:= FALSE, \n\tbagOpenSensorEnabled:= FALSE, \n\tcancelPrint := HMIData.printerCancelRequest,\n\tseparateBeforeSealEnabled:= HMIData.separateBeforeSeal, \n\tbagOpenRetrySetting:= , \n\tnewJobLoaded:= , \n\tvacuumDwell:= , \n\tbagOpenRetryCount=> , \n\tfailedToOpenBag=> );\n\t\n\nEM02_SXDischarge();\n\n// Machine unit\nUN00_SXMachine(faultActive:= HMIData.faultActive, resetMachine := HMIData.ackAllFaults, homeMachine := HMIData.homeMachine, currentState=> , baggerHead:= EM01_SXBaggerHead, discharge:= EM02_SXDischarge);\n\n// Trigger fault if top cover lifted during cycle\nIF HMIData.inCycle AND NOT iSafePowerOK THEN\n\tsafePowerOffFault.Trigger();\nEND_IF\nIF NOT iEstopNormal THEN\n\teStopPressedFault.Trigger();\nEND_IF\n\n// Banner palm button has 4 states - off, solid green, 50/50 green/white rotating, and flashing red\npalmButton(\n\tbaggerReady:= UN00_SXMachine.currentState = PACK_ML.State.Execute, \n\tbaggerFaulted:= HMIData.faultActive, \n\tbaggerInCycle:= HMIData.inCycle, \n\tpalmState0Output=> oPalmButton0, \n\tpalmState1Output=> oPalmButton1);\n\t\n//\n// HMI Mapping\n//\n\n// change jaw close position from HMI\nIF HMIData.HMIMetric THEN\nAxisData.jawCloseMotionProfile.position := (HMIData.jawClosePositionSetting/25.4);\nELSE\nAxisData.jawCloseMotionProfile.position := HMIData.jawClosePositionSetting;\nEND_IF\n\n//code to add timer to track duration in states\nstateTimer(PT:=T#10000S);\nstateTimer.IN := UN00_SXMachine.baggerManager.BaggerAutoMode.baggerCycleActive;\nIF clr THEN\n\tspeedTracking:=speedTracking_mt;\n\tclr:=FALSE;\nEND_IF\nIF UN00_SXMachine.baggerManager.BaggerAutoMode.baggerCycleActive AND NOT hold THEN\n\t\tcount_index := count_index +1;\n\t\thold:=TRUE;\nELSIF hold AND NOT UN00_SXMachine.baggerManager.BaggerAutoMode.baggerCycleActive THEN\n\thold := FALSE;\t\nEND_IF\nIF stateTimer.ET>T#0MS THEN\n\tspeedTracking[state_index][count_index] := stateTimer.ET;\nEND_IF\nIF count_index >=20 THEN\n\tcount_index :=0;\nEND_IF\nresetHold(IN:=HMIData.ackAllFaults,PT:=T#5000MS);\nIF HMIData.ackAllFaults THEN\n\tIF UN00_SXMachine.currentState = PACK_ML.State.Resetting OR resetHold.Q THEN\n\t\tHMIData.ackAllFaults:= FALSE;\n\tEND_IF\nEND_IF\n\n//End modded code\n// Send the list of active fault strings to HMI for viewing\nHMIData.activeFaults := GlobalObjects.CollectionOfActiveFaults.ObjNames;\nHMIData.activeFaultIds := GlobalObjects.CollectionOfActiveFaults.ObjIds;\nhmiFaultMessage(faultActive:= GlobalObjects.CollectionOfActiveFaults.faultActive,faultList:= GlobalObjects.CollectionOfActiveFaults.ObjNames);\nHMIData.faultMessage:=hmiFaultMessage.faultMessagestr;\nHMIData.inCycle := UN00_SXMachine.baggerManager.BaggerAutoMode.baggerCycleActive;\nGlobalObjects.CollectionOfComponents.UpdateInfo();\n// PackML state to string for HMI\nHMIData.currentPackMLState := UN00_SXMachine.baggerManager.BaggerAutoMode.currentBaggerState;\n\noFansEnable := NOT HMIData.standbyActive;\n\n// Banner manager takes care of the Multistate lamp used as a banner on the proface \nbannerManager(\n\tfaultActive := GlobalObjects.CollectionOfActiveFaults.faultActive,\n\tbaggerNotReady:= NOT UN00_SXMachine.currentState = PACK_ML.State.Execute, \n\tbaggerReady:= GlobalObjects.CollectionOfComponents.CheckIfAllReady() AND UN00_SXMachine.currentState = PACK_ML.State.Execute AND NOT HMIData.inCycle AND NOT HMIData.batchCounterDone, \n\tbaggerInCycle:= HMIData.inCycle, \n\tnoBagCoveringEye:= baggerCM.bagDelivery.noBagOverEye.Active, \n\tbagFailedToSeperate:= baggerCM.bagDelivery.bagFailedToSeparate.Active, \n\tpbarObstruction:= baggerCM.dualMotorPassthrough.pressureBarObstructed.Active, \n\tlightCurtainViolation:= , \n\tprintHeadFTR:= baggerCM.labelPrinter.printHeadFailToRaise.Active, \n\tprintHeadFTL:= baggerCM.labelPrinter.printHeadFailToLower.Active, \n\tbarcodeFault:= EM01_SXBaggerHead.barcodeVerificationFailed.Active, \n\ttooManyPartsCounted:= , \n\tjawFailedToClose:= baggerCM.dualMotorPassthrough.failedToClose.Active, \n\tjawFailedToHome:= baggerCM.dualMotorPassthrough.failedToHome.Active, \n\tfilmFeedMotorFault:=  baggerCM.bagDeliveryFrontMotor.error OR baggerCM.bagDelivery.reverseFault.Active,\n\tjawMotionFault:= baggerCM.jawFrontMotor.error OR baggerCM.dualMotorPassthrough.frontMotorFault.Active OR baggerCM.dualMotorPassthrough.frontMotorCommFault.Active,\n\t//jawMotionFault:= baggerCM.dualMotorPassthrough.bothMotorsFault.Active, \n\twaitingOnPrinter:= UN00_SXMachine.baggerManager.BaggerAutoMode.releaseAndFeedSubState = RELEASE_FEED_STATES.WaitForPrinter,\n\twaitingOnFiller:= , \n\tbatchCounterDone:= HMIData.batchCounterDone, \n\tjawNotHomed:= NOT baggerCM.dualMotorPassthrough.IsHomed AND NOT HMIData.inCycle, \n\tcycleBaggerTForFiller:= , \n\tmachineNotTested:=  HMIData.bagsMade < 1000, \n\t//loadPlateMotorNotHomed:= NOT baggerCM.loadPlate.IsHomed AND baggerCM.loadPlate.OptionActive, \n\t//loadPlateMotorFaulted:= baggerCM.loadPlate.motorFault.Active, \n\t//loadPlateMotorCommF:= baggerCM.loadPlate.motorCommFault.Active, \n\tsafePowerFault:= safePowerOffFault.Active, \n\tsafePowerWarning:= NOT iSafePowerOK AND NOT HMIData.inCycle, \n\t//IBDMotorNotHomed:= NOT baggerCM.IBD.IsHomed AND baggerCM.IBD.OptionActive AND NOT HMIData.inCycle, \n\t//IBDMotorFaulted:= baggerCM.IBD.IBDMotorFault.Active, \n\t//IBDMotorCommF:= baggerCM.IBD.IBDMotorCommFault.Active, \n\tprinterRibbonFault := baggerCM.labelPrinter.ribbonFault.Active,\n\tprinterServiceRequired := baggerCM.labelPrinter.serviceRequired.Active,\n\tjawFailedToOpen:= baggerCM.dualMotorPassthrough.failedToOpen.Active, \n\tIBDFailedToClose:= baggerCM.dualMotorPassthrough.failedToClose.Active, \n\t//IBDFailedToOpen:= baggerCM.IBD.failedToOpen.Active, \n\tmessageDisplayIndication=> HMIData.bannerMessageIndication,\n\tactiveFaultIds := GlobalObjects.CollectionOfActiveFaults.ObjIds);\n\n// Ready indications for bagger control modules\nHMIData.printerReady := baggerCM.labelPrinter.Ready;\nHMIData.bagDeliveryReady := baggerCM.bagDelivery.Ready;\n//HMIData.loadPlateReady := baggerCM.loadPlate.Ready;\nHMIData.jawReady := baggerCM.dualMotorPassthrough.Ready;\nHMIData.bcvReady := baggerCM.barcodeVerifier.Ready;\nHMIData.IBDReady := baggerCM.IBD.Ready;\n\n// Motor data to HMI for troubleshooting\nHMIData.frontJawMotorData.ActPos := baggerCM.jawFrontMotor.ActPos;\nHMIData.frontJawMotorData.CommandedPos := baggerCM.jawFrontMotor.TargetPosDist;\nHMIData.frontJawMotorData.CurrentAlarmCode := baggerCM.jawFrontMotor.alarmCode;\n\n\n//HMIData.bagDeliveryMotorData.alarmCode := baggerCM.bagDeliveryFrontMotor.alarmCode;;\n\n\n\n// Cycle time and bags made counters\nHMIData.cycleTime := UN00_SXMachine.baggerManager.BaggerAutoMode.cycleTime;\nHMIData.inCycle := UN00_SXMachine.baggerManager.BaggerAutoMode.cycleTimer.IN;\ncycleComplete(CLK := UN00_SXMachine.baggerManager.BaggerAutoMode.cycleComplete);\nIF cycleComplete.OSR THEN\n\tHMIData.bagsMade := HMIData.bagsMade + 1;\nEND_IF\n\n// Printer and Barcode Verifier combination enable/disable\nHMIData.printerAndVerifierEnableIndication := HMIData.printerInUse AND HMIData.barcodeVerifierInUse;\nIF HMIData.printerAndVerifierEnablePB THEN\n\tIF HMIData.printerAndVerifierEnableIndication THEN\n\t\tHMIData.printerInUse := FALSE;\n\t\tHMIData.barcodeVerifierInUse := FALSE;\n\tELSE\n\t\tHMIData.printerInstalled := TRUE;\n\t\tHMIData.barcodeVerifierInstalled := TRUE;\n\t\tHMIData.printerInUse := TRUE;\n\t\tHMIData.barcodeVerifierInUse := TRUE;\n\tEND_IF\n\tHMIData.printerAndVerifierEnablePB := FALSE;\nEND_IF\n\n// Position Indications for service commands\nHMIData.jawService.extendedFeedback := baggerCM.dualMotorPassthrough.IsFullyOpen;\nHMIData.jawService.retractedFeedback := baggerCM.dualMotorPassthrough.IsFullyClosed;\n\n//HMIData.IBDService.extendedFeedback := baggerCM.IBD._isFullyOpen;\n//HMIData.IBDService.retractedFeedback := NOT baggerCM.IBD._isFullyOpen;\n\nHMIData.printHeadService.extendedFeedback := oLowerPrinthead;\nHMIData.printHeadService.retractedFeedback := NOT oLowerPrinthead;\n\n// Amazon Bags per minute throughput calculator\namazonBPM(\n\tinCycle:= HMIData.inCycle, \n\truntimeTimeout:= , \n\treset:= HMIData.BPMReset, \n\tBPM=> HMIData.BPMBagsPerMinute, \n\tBPMCycles=> HMIData.BPMBagsMade, \n\tBPMSeconds=> , \n\tBPMIndication=> HMIData.BPMActiveTime);\n\n// \"Aux-IO\" outputs\noBaggerOK := UN00_SXMachine.currentState = PACK_ML.State.Execute;\noWaitingForPrinter := (UN00_SXMachine.baggerManager.BaggerAutoMode.releaseAndFeedSubState = RELEASE_FEED_STATES.WaitForPrinter);","LineInfoPersistence":"(string)d84df67b-39c5-48c2-a0a4-faae00bb76c7_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)PROGRAM PLC_PRG_1\nVAR\n\tfirstScanDone: BOOL;\n\tfirstAborted :BOOL:=TRUE;\n\tcycleStartONS : FB_ONS;\n\t//powerUpFrontJawMotor : MC_Power;\n\tpowerUpRearJawMotor : MC_Power;\n\tpowerUpBothJawMotors : MC_Power;\n\tpowerUpLoadPlateMotor : MC_Power;\n\tpowerUpBagDeliveryMotor : MC_Power;\n\tpowerUpIBDMotor : MC_Power;\n\tUN00_SXMachine : FB_UN00_SharpMachine(name := 'UN00 - Sharp SX');\n\tEM01_SXBaggerHead : EM01_BaggerHead(name := 'EM01 - SX Bagger Head');\n\tEM02_SXDischarge : EM02_Discharge(name := 'EM02 - SX Discharge');\n\tbaggerCM : EM01_BaggerCM;\n\tdischargeCM : EM02_DischargeCM;\n\tbannerManager : FB_BannerManager;\n\thmiFaultMessage : FB_FaultMessageHandler;\n\tpalmButton : FB_BannerPalmButton;\n\tsafePowerOffFault : FB_Fault(name := 'Safety Circuit Broken During Cycle', faultID := faultMessageList.SAFE_POWER_OFF);\n\teStopPressedFault : FB_Fault(name := 'E-Stop Pressed', faultID := faultMessageList.ESTOP_PRESSED);\n\tlightCurtainPresent : FB_Fault(name := 'Light Curtain Not Configured', faultID := faultMessageList.LIGHT_CURTAIN_NOT_CONFIGURED);\n\tamazonBPM : FB_AmazonThroughput();\n\tprinterLabel : FB_PrinterSerial();\n\tautoModeTimer : Standard.TON;\n\tautoModeKeepCycling : BOOL;\n\tautoModeInitiateCycleONS : FB_ONS;\n\tcycleComplete : FB_ONS;\n\thIecTask : RTS_IEC_HANDLE;//Declaration of the variable hIecTask\n\tteachPhotoeyeTimer : Standard.TOF() := (PT := T#3S);\n\t//variables for the state timer\n\tstateTimer:TON;\n\tlaststate: INT;\n\tcount_index :INT :=0;\n\tclr:BOOL:=FALSE;\n\tspeedTracking : ARRAY[0..20] OF ARRAY[0..20] OF TIME;\n\tspeedTracking_mt : ARRAY[0..20] OF ARRAY[0..20] OF TIME:=[21([21(T#0S)])]; \n\tstate_index : INT:=0;\n\thold: BOOL;\n\tloadPlateInterlocks: DINT := 0;\n\tresetHold: Ton;\n\tflipFlop: TON;\n\tbatchCounter : CTU;\n\tcycleStartDebounce : TON := (PT := T#75MS);\n\tlightCurtainStartONS : FB_ONS;\n\tlightCurtainStartClear : BOOL;\n\tpartsCounter : CTU;\nEND_VAR","LineInfoPersistence":"(string)d84df67b-39c5-48c2-a0a4-faae00bb76c7_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)1904","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}