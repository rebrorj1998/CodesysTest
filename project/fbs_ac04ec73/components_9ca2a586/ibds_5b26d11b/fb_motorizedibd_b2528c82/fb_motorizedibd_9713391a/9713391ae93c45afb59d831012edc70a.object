{"payload":{"meta":{"Graph":{"@Type":"81297157","@Value":{"Guid":"(Guid)9713391a-e93c-45af-b59d-831012edc70a","ParentGuid":"(Guid)00000000-0000-0000-0000-000000000000","Name":"(string)FB_MotorizedIBD","Properties":{"@Type":"2c41fa04:IDictionary","@Value":[{"@Key":"(Guid)829a18f2-c514-4f6e-9634-1df173429203","@Value":{"@Type":"829a18f2","@Value":{"ParentObjects":{"@Type":"fa2ee218:IDictionary","@Value":[{"@Key":"(Guid)21af5390-2942-461a-bf89-951aaf6999f1","@Value":"(Guid)b2528c82-e8fd-408c-bdc8-1b92c0ca2197"}]}}}}]},"TypeGuid":"(Guid)6f9dac99-8de1-4efc-8465-68ac443b7d08","EmbeddedTypeGuids":{"@Type":"[Guid]","@Value":["(Guid)a9ed5b7e-75c5-4651-af16-d2c27e98cb94","(Guid)3b83b776-fb25-43b8-99f2-3c507c9143fc"]}}},"TypeInfos":{"2c41fa04":"{2c41fa04-1834-41c1-816e-303c7aa2c05b}","81297157":"{81297157-7ec9-45ce-845e-84cab2b88ade}","829a18f2":"{829a18f2-c514-4f6e-9634-1df173429203}","fa2ee218":"{fa2ee218-a39b-4b6d-b249-49dbddbd168a}","Guid":"System.Guid","string":"System.String"}},"object":{"Graph":{"@Type":"6f9dac99","@Value":{"SpecialFunc":{"@Type":"0db3d7bb:Enum","@Value":"None"},"Implementation":{"@Type":"3b83b776","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)\nactualPosition := IBDMotor.absolutePositonInches;\nIBDOpen := TO_DINT(actualPosition * 1000) >= (TO_DINT((pbarOutSetting) * 1000) - 10) AND TO_DINT(actualPosition * 1000) <= (TO_DINT((pbarOutSetting)* 1000) + 10);\nIBDFullyOpen := TO_DINT(actualPosition * 1000) >= (TO_DINT(12 * 1000) - 10) AND TO_DINT(actualPosition * 1000) <= (TO_DINT(12 * 1000) + 10);\n//IBDOpen := TO_DINT(IBDMotor.absolutePositonInches) = TO_DINT(pbarOutSetting);\ndelayTimer();\nhomeFaultTimer();\n\nclamped := state = MotorizedIBDStates.Clamping;\n\nfailToOpenTimer(IN := state = MotorizedIBDStates.MovingJawOut OR state = MotorizedIBDStates.MovingOutFull);\n\nIF NOT IBDMotor.HomeRequired THEN\n\tIF extendCommand THEN\n\t\textendCommand := FALSE;\n\t\tIBDMotor.MoveToPositionTorque(pbarOutSetting,accel,decel,velo,testCurrent);\n\tELSIF retractCommand THEN\n\t\tretractCommand := FALSE;\n\t\tIBDMotor.MoveToPositionTorque(inPositionSetting,accel,decel,velo,testCurrent);\n\tEND_IF\nEND_IF\n\n\nIF testZeroCurrent THEN\n\tIBDMotor.SetTorque(0);\n\ttestZeroCurrent := FALSE;\nEND_IF\n\nIF testSomeCurrent THEN\n\tIBDMotor.SetTorque(testCurrent);\n\ttestSomeCurrent := FALSE;\nEND_IF\n\n\nIF resetONS.Q THEN\n\t//IF IBDMotor.Faulted THEN\n\t\tIBDMotor.Reset();\n\t//END_IF\n\tIBDMotor.ResetEncoderPosition(IBDMotor.driveInputs[5]);\n\t_reset := FALSE;\n\t_openIBD := FALSE;\n\t_closeIBD := FALSE;\n\t_homeNow := FALSE;\n\tstartTest := FALSE;\n\ttestActive := FALSE;\n\tdelayTimer.IN := FALSE;\n\tstate := MotorizedIBDStates.Idle; \n\tfailedToHome := FALSE;\nEND_IF\nfaultingONS(CLK := IBDMotor.Faulted AND NOT disableFaults);\n\nIF (faultingONS.OSR AND disableFaults)\n\tAND state <> MotorizedIBDStates.Faulted\nTHEN\n\tstate := MotorizedIBDStates.Faulting; \nEND_IF\n\nhomeRequiredONS(CLK := IBDMotor.homeRequired);\nIF homeRequiredONS.OSR THEN\n\thomeRequired := TRUE;\nEND_IF\n\n_ready := state = MotorizedIBDStates.Idle AND NOT homeRequired AND IBDOpen;\n\nCASE state OF\n\tMotorizedIBDStates.Idle :\t\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF startTest THEN\n\t\t\t\t\t\t\t\t\t\t\tstartTest := FALSE;\n\t\t\t\t\t\t\t\t\t\t\ttestActive := TRUE;\n\t\t\t\t\t\t\t\t\t\t\tIF IBDMotor.homeRequired THEN\n\t\t\t\t\t\t\t\t\t\t\t\tIBDMotor.HomeNow();\n\t\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Homing;\n\t\t\t\t\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Initialize;\n\t\t\t\t\t\t\t\t\t\t\tEND_IF\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tIF _homeNow THEN\n\t\t\t\t\t\t\t\t\t\t\t//IF IBDMotor.HomeRequired THEN\n\t\t\t\t\t\t\t\t\t\t\t\tIBDMotor.HomeNow();\n\t\t\t\t\t\t\t\t\t\t\t//END_IF\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.PT := T#150MS;\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := TRUE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Homing;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t(*                   \t\n\t\t\t\t\t\t\t\t\t\tIF IBDMotor.HomeRequired THEN\n\t\t\t\t\t\t\t\t\t\t\t//_homeNow := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tIBDMotor.HomeNow();\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.PT := T#150MS;\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := TRUE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Homing;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n*)\n\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tIF IBDMotor.status.motorEnabled AND NOT IBDMotor.HomeRequired THEN\n\t\t\t\t\t\t\t\t\t\t\tIF _openIBD THEN\n\t\t\t\t\t\t\t\t\t\t\t\tIF NOT IBDOpen THEN\n\t\t\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MoveJawOut;\n\t\t\t\t\t\t\t\t\t\t\t\tEND_IF\t\n\t\t\t\t\t\t\t\t\t\t\t_openIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tIF _closeIBD THEN\n\t\t\t\t\t\t\t\t\t\t\t_closeIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MoveJawIn;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tIF _openFull THEN\n\t\t\t\t\t\t\t\t\t\t\t_openFull := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MoveOutFull;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\n\t\n\tMotorizedIBDStates.Homing :\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF NOT (IBDMotor.homeRequired) AND delayTimer.Q THEN\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\t\thomeRequired := FALSE;\n\t\t\t\t\t\t\t\t\t\t\t_homeNow := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Initialize;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\t\n\tMotorizedIBDStates.Initialize :\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF IBDOpen THEN\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Initialized;\n\t\t\t\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := TRUE;\n\t\t\t\t\t\t\t\t\t\t\tIF delayTimer.Q THEN\n\t\t\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\t\t\tIBDMotor.MoveToPosition(pbarOutSetting,accel,decel,velo);\n\t\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Initializing;\t\n\t\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tEND_IF\t\n\t\n\tMotorizedIBDStates.Initializing :\t\n\t\t\t\t\t\t\t\t\t\thomeFaultTimer.IN := TRUE;\n\t\t\t\t\t\t\t\t\t\tIF IBDOpen THEN\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Initialized;\n\t\t\t\t\t\t\t\t\t\t\thomeFaultTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\tELSE\n\t\t\t\t\t\t\t\t\t\t\tIF homeFaultTimer.Q THEN\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\thomeFaultTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\t\t\tfailedToHome := TRUE;\n\t\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Faulting;\n\t\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\tMotorizedIBDStates.Initialized :\t\t\t//\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Idle;\n\t\n\t\n\tMotorizedIBDStates.MoveJawOut :\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.MoveToPositionTorque(pbarOutSetting,accel,decel,velo,testCurrent);\n\t\t\t\t\t\t\t\t\t\tIBDMotor.MoveToPosition(pbarOutSetting,accel,decel,velo);\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MovingJawOut;\n\t\t\t\t\t\t\t\t\t\t_openIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.SetPositionLimit(150);\n\t\n\tMotorizedIBDStates.MovingJawOut :\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF IBDOpen THEN\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Idle;\n\t\t\t\t\t\t\t\t\t\tELSIF failToOpenTimer.Q THEN\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Faulting;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\tMotorizedIBDStates.MovedJawOut :\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\n\tMotorizedIBDStates.MoveOutFull :\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.MoveToPositionTorque(pbarOutSetting,accel,decel,velo,testCurrent);\n\t\t\t\t\t\t\t\t\t\tIBDMotor.MoveToPosition(pbarOutSetting,accel,decel,velo);\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MovingOutFull;\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.SetPositionLimit(150);\n\t\n\tMotorizedIBDStates.MovingOutFull :\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF IBDOpen THEN\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Idle;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\t\n\tMotorizedIBDStates.MovedOutFull :\t\t\t//\n\t\n\tMotorizedIBDStates.MoveJawIn :\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tIBDMotor.MoveToPositionTorque(inPositionSetting,accel,decel,velo,testCurrent);\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.MoveToPosition(0,accel,decel,velo+(TO_INT(TO_REAL(velo)*0.25)));\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MovingJawIn;\n\t\n\t\n\tMotorizedIBDStates.MovingJawIn : \t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF IBDMotor.alarms.currentFoldback OR IBDMotor.InPosition THEN\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Clamping;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\t\n\tMotorizedIBDStates.MovedJawIn :\t\t\t//\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.StartClamping;\n\t\n\t\n\tMotorizedIBDStates.StartClamping :\t\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\n\tMotorizedIBDStates.StartedClamping :\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\n\t\n\tMotorizedIBDStates.Clamping :\t\t\t\t//\n\t\t\t\t\t\t\t\t\t\tIF _openIBD THEN\n\t\t\t\t\t\t\t\t\t\t\t_openIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MoveJawOut;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tIF _openFull THEN\n\t\t\t\t\t\t\t\t\t\t\t_openFull := FALSE;\n\t\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.MoveOutFull;\n\t\t\t\t\t\t\t\t\t\tEND_IF\n\t\n\t\n\tMotorizedIBDStates.ReleaseClamp :\t\t\t//  \n\t\t\t\t\t\t\t\t\t\t\n\t\n\tMotorizedIBDStates.ReleasingClamp :\t\t//\n\t\t\t\t\t\t\t\t\t\t\n\t\n\tMotorizedIBDStates.Faulting :\t\t\t// \n\t\t\t\t\t\t\t\t\t\tGlobals.jawMovingIn := FALSE;\n\t\t\t\t\t\t\t\t\t\t_reset := FALSE;\n\t\t\t\t\t\t\t\t\t\t_openIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\t_closeIBD := FALSE;\n\t\t\t\t\t\t\t\t\t\t_homeNow := TRUE;\n\t\t\t\t\t\t\t\t\t\tstartTest := FALSE;\n\t\t\t\t\t\t\t\t\t\ttestActive := FALSE;\n\t\t\t\t\t\t\t\t\t\tdelayTimer.IN := FALSE;\n\t\t\t\t\t\t\t\t\t\t//homeRequired := TRUE;\n\t\t\t\t\t\t\t\t\t\t//IBDMotor.MoveDistanceTorque(velocity:=100, acceleration := 1, deceleration := 1, distance := 0, current := 0);\n\t\t\t\t\t\t\t\t\t\tIBDMotor.Disable();\n\t\t\t\t\t\t\t\t\t\tstate := MotorizedIBDStates.Faulted;\n\t\n\tMotorizedIBDStates.Faulted :\t\t\t\t//\n\t\n\t\n\n\nEND_CASE\n\t\nfeedbackHandler(\n\textendedFeedbackInput:= IBDOpen OR IBDFullyOpen, \n\tretractedFeedbackInput:= , \n\textendOutput:= state = MotorizedIBDStates.MovingJawOut, \n\tretractOutput:= state = MotorizedIBDStates.MovingJawIn, \n\textendFaultDelay:= 3000 , \n\tretractFaultDelay:= 3000 , \n\tfaultMonitoring:= (state = MotorizedIBDStates.MovingJawOut) OR (state = MotorizedIBDStates.MovingOutFull), \n\tfailedToExtend=> failToOpen.faultTrigger, \n\tfailedToRetract=> );\nSUPER^();","LineInfoPersistence":"(string)9713391a-e93c-45af-b59d-831012edc70a_Impl_LineIds"}}}},"Interface":{"@Type":"a9ed5b7e","@Value":{"TextDocument":{"@Type":"f3878285","@Value":{"TextBlobForSerialisation":"(string)FUNCTION_BLOCK FB_MotorizedIBD EXTENDS FB_BaseComponent\nVAR_INPUT\n\tpbarOutSetting : REAL := 12.0;\n\tIBDOutCalculated : REAL := 12.0;\n\tinPositionSetting : REAL;\n\tIBDOffsetToJaw : REAL := 2.0;\n\tdisableFaults : BOOL;\n\textendCommand : BOOL;\n\tretractCommand : BOOL;\nEND_VAR\nVAR_OUTPUT\n\tfailToOpen : FB_Fault(name := 'IBD Fail to Open');\n\tstate : MotorizedIBDStates;\n\tactualPosition : REAL;\n\tIBDOpen : BOOL;\n\tIBDFullyOpen : BOOL;\n\thomeRequired : BOOL;\n\tclamped : BOOL;\n\tfailedToHome : BOOL;\nEND_VAR\nVAR\n\t_homeNow : BOOL;\n\t_openIBD : BOOL;\n\t_closeIBD : BOOL;\n\t_openFull : BOOL;\n\taccel : INT := 75;\n\tdecel : INT := 75;\n\tvelo : INT := 1250;\n\ttestCurrent : DINT := 500;\n\ttestZeroCurrent : BOOL;\n\ttestSomeCurrent : BOOL;\n\tstartTest : BOOL;\n\ttestActive : BOOL;\n\tmovePassthroughNow : BOOL;\n\tdelayTimer : Standard.TON := (PT:= T#500MS);\n\tfailToOpenTimer : Standard.TON := (PT := T#2S);\n\thomeFaultTimer : Standard.TON := (PT := T#5S);\n\thomeRequiredONS : FB_ONS;\n\tfaultingONS : FB_ONS;\n\tfeedbackHandler : FB_CylinderFeedback;\nEND_VAR\nVAR_IN_OUT\n\tIBDMotor : FB_AppliedMotionStepServoEIPPassthrough;\nEND_VAR","LineInfoPersistence":"(string)9713391a-e93c-45af-b59d-831012edc70a_Decl_LineIds"}}}},"UniqueIdGenerator":"(string)2433","POULevel":{"@Type":"8e575c5b:Enum","@Value":"Standard"},"ChildObjectGuids":{"@Type":"ArrayList:IList","@Value":[]},"AddAttributeSubsequent":"(bool)False"}},"TypeInfos":{"0db3d7bb":"{0db3d7bb-cde0-4416-9a7b-ce49a0124323}","3b83b776":"{3b83b776-fb25-43b8-99f2-3c507c9143fc}","6f9dac99":"{6f9dac99-8de1-4efc-8465-68ac443b7d08}","8e575c5b":"{8e575c5b-1d37-49c6-941b-5c0ec7874787}","a9ed5b7e":"{a9ed5b7e-75c5-4651-af16-d2c27e98cb94}","ArrayList":"System.Collections.ArrayList","bool":"System.Boolean","f3878285":"{f3878285-8e4f-490b-bb1b-9acbb7eb04db}","string":"System.String"}}},"FormatVersion":"1.0"}