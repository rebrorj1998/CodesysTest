

FUNCTION_BLOCK FB_TCPClient
VAR_INPUT
END_VAR
VAR_OUTPUT
END_VAR

VAR
    // =======================================
    // set up Client
    // =======================================
    _TCPClient : NBS.TCP_Client;
    _TCPClient_ipAddr: NBS.IP_ADDR;
    _TCPClient_uiPort: UINT := 9100;
    _TCPClient_hClient : CAA.HANDLE; // Client handle
    _sClientIP : STRING(15):='192.168.10.160'; (* this device's Client IP address *)
    _uiPort : UINT:= 9100;
    _TCPConnection : NBS.TCP_Connection; // TCP connection instances
    _TCPConnection_hConnection: CAA.HANDLE;    // handle of client connections    
    _TCPWrite : NBS.TCP_Write; // TCP write
    _TCPRead : NBS.TCP_Read; // TCP read
    _sTCPSendData: STRING(16000); // This is the label
    _sTCPReadData: STRING(1000); //receive up to 1000 chars if needed
    _TCPWriteEn: BOOL;
    _sServerIP: STRING(80);
    _sendLabel : BOOL;
END_VAR

//    Program: PRG_TCP_Client
//    Description: This provides TCP Comms to the zebra printer
//    
//    Created by: Ben Hess
//    Created Date: Tuesday, May 1, 2018

// Here's an example label
_sTCPSendData := 
'^XA~TA000~JSN^LT0^MNW^MTT^PON^PMN^LH0,0^JMA^PR8,8~SD15^JUS^LRN^CI0^XZ
^XA
^MMT
^PW812
^LL1218
^LS0
^FO0,0^GFA,129792,129792,00104,:Z64:
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:58B5
^PQ1,0,1,Y^XZ';

_TCPClient_ipAddr.sAddr := _sClientIP; //set IP address
_TCPClient(
xEnable:= _sendLabel AND NOT _TCPWrite.xDone, // manually toggle for testing
xDone=> ,
xBusy=> ,
xError=> ,
ipAddr:= _TCPClient_ipAddr, 
uiPort:= _uiPort,
eError=> ,
hConnection=> _TCPConnection_hConnection);

// set TCP connection
_TCPConnection(
xEnable:= _TCPClient.xBusy AND NOT(_TCPConnection.xDone), //when server is ready
xDone=> , // client manually disconnected
xBusy=> ,
xError=> ,
hServer:=, // point all connections back to the same server
eError=> ,
xActive=> , 
hConnection=> );

// only execute on active connections

// write when connection is ready
_TCPWrite(
xExecute:= _sendLabel AND _TCPClient.xActive, //manually enable for testing
udiTimeOut:= 600000, //in microseconds => 600ms
xDone=> ,
xBusy=> , 
xError=> ,
hConnection := _TCPConnection_hConnection,
szSize := 16000, // write length only
pData := ADR(_sTCPSendData), 
eError=> );
//reset write enable
IF(_TCPWrite.xDone) THEN
_TCPWriteEn:= FALSE;
_sendLabel := FALSE;
END_IF



METHOD SendLabel
VAR_INPUT
END_VAR

_sendLabel := TRUE;